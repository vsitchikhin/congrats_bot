# üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ó–∞–¥–∞—á–∏ 4.1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ-–æ–±—Ä–∞—â–µ–Ω–∏—è (TTS) —Å –ø–æ–º–æ—â—å—é ElevenLabs

## –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
–°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å `src/services/tts.ts` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API `elevenlabs.io` —Å —Ü–µ–ª—å—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ —Å –æ–∑–≤—É—á–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º —Ä–µ–±–µ–Ω–∫–∞.

## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`src/config.ts` –∏ `.env.example`):**
    *   –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `ELEVENLABS_API_KEY` (—Å—Ç—Ä–æ–∫–∞) –∏ `ELEVENLABS_VOICE_ID` (—Å—Ç—Ä–æ–∫–∞) –≤ `src/config.ts` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ `Valibot`.
    *   –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏-–∑–∞–≥–ª—É—à–∫–∏ –≤ `.env.example`.

2.  **–°–µ—Ä–≤–∏—Å TTS (`src/services/tts.ts`):**
    *   –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å, –µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç) —Ñ–∞–π–ª `src/services/tts.ts`.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `generate(childName: string): Promise<string>`, –∫–æ—Ç–æ—Ä–∞—è:
        *   –î–æ–±–∞–≤–ª—è–µ—Ç –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫ "!" –∫ `childName` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ API.
        *   –§–æ—Ä–º–∏—Ä—É–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å (POST) –∫ –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–µ ElevenLabs API (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://api.elevenlabs.io/v1/text-to-speech/{voice_id}`).
        *   –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Xi-Api-Key` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `ELEVENLABS_API_KEY`.
        *   –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–µ `childName` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ (—Ñ–æ—Ä–º–∞—Ç `JSON`).
        *   –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept: audio/mpeg` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫–∞.
        *   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç API, –æ–∂–∏–¥–∞—è –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫.
        *   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∞—É–¥–∏–æ–¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.mp3` –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `./temp/audio/`) —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `childName-timestamp.mp3`).
        *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É –∞—É–¥–∏–æ—Ñ–∞–π–ª—É.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ API, —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º –∏ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤.

3.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–æ—Ä–∫–µ—Ä–æ–º (`src/queue/processors/video-generation.ts`):**
    *   –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `ttsService` –≤ `src/queue/processors/video-generation.ts`.
    *   –í—ã–∑–≤–∞—Ç—å `const audioPath = await ttsService.generate(videoJob.childName);` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—É—Ç–∏ –∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∞—É–¥–∏–æ—Ñ–∞–π–ª—É.
    *   –ü–µ—Ä–µ–¥–∞—Ç—å `audioPath` –≤ —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ (–ó–∞–¥–∞—á–∞ 4.2).

4.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker (`docker-compose.yml`):**
    *   –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `ELEVENLABS_API_KEY` –∏ `ELEVENLABS_VOICE_ID` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å `worker`.

5.  **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    *   –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `ttsService.generate` –≤ `tests/services/tts.test.ts`. –ú–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã ElevenLabs API.
    *   –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å —É—Å–ø–µ—à–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é, –æ—à–∏–±–∫–∏ API –∏ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `axios` –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `fetch` –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.
- `node:fs/promises` –∏ `node:path` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π.

## –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏
- –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å ElevenLabs API.
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ElevenLabs API.
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ API ElevenLabs.

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏
- ‚úÖ –°–µ—Ä–≤–∏—Å `ttsService` —É—Å–ø–µ—à–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª —Å –æ–∑–≤—É—á–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º —Ä–µ–±–µ–Ω–∫–∞ (—Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º "!") —á–µ—Ä–µ–∑ ElevenLabs API.
- ‚úÖ –ê—É–¥–∏–æ—Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.
- ‚úÖ –ö–ª—é—á–∏ API –∏ ID –≥–æ–ª–æ—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- ‚úÖ –û—à–∏–±–∫–∏ API –∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.
- ‚úÖ –í–æ—Ä–∫–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç `ttsService`.
- ‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç unit-—Ç–µ—Å—Ç—ã.