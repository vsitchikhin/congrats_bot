# План реализации Задачи 2.2: Создание пошагового диалога

## Описание задачи
Используя плагин `grammy/conversations`, реализовать сценарий сбора данных: запрос имени ребенка и финальное подтверждение данных перед постановкой в очередь.

## План действий

1.  **Установка зависимостей:** Установить npm-пакет `@grammyjs/conversations` и соответствующие типы для TypeScript.
2.  **Регистрация плагина:** Зарегистрировать плагин `conversations` в `src/bot/index.ts`. Это включает добавление middleware для `conversations` и `createConversation`.
3.  **Создание беседы (conversation):** Создать новую функцию беседы (например, `greetingConversation`) в файле `src/bot/features/greeting.ts`. Эта беседа должна:
    *   Запрашивать у пользователя имя ребенка.
    *   Ожидать ответа пользователя.
    *   Предлагать пользователю подтвердить введенное имя.
    *   Обрабатывать подтверждение или отмену.
4.  **Интеграция беседы:** Изменить обработчик команды `/start` в `src/bot/features/greeting.ts`, чтобы он запускал `greetingConversation` вместо простого ответа `greeting.welcome`.
5.  **Локализация:** Добавить новые строки локализации в `locales/en.ftl` и `locales/ru.ftl` для всех сообщений, связанных с беседой (запрос имени, подтверждение, сообщения об ошибках валидации, отмена).
6.  **Валидация данных:** Внедрить базовую валидацию для введенного имени ребенка (например, проверка на пустую строку, минимальную/максимальную длину, отсутствие недопустимых символов).
7.  **Обработка отмены:** Предусмотреть механизм отмены беседы пользователем (например, командой `/cancel` или конкретным текстовым ответом).

## Зависимости
*   `@grammyjs/conversations`
*   `src/bot/context.ts` (для расширения контекста)
*   `src/bot/features/greeting.ts`
*   `src/bot/index.ts`
*   `locales/ru.ftl`

## Потенциальные риски
*   Сложность в обработке состояний внутри беседы.
*   Конфликты с другими командами или обработчиками во время активной беседы.
*   Недостаточная валидация пользовательского ввода.
*   Сложность в тестировании пошаговых диалогов.
